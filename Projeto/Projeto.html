<html>
  <head>
    <meta charset="utf-8">
    <meta name="author" content="Edcley José da Silva 032018 POS">
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src='./crossfilter.min.js'></script>
    <script src='./dc.min.js'></script>
    <script src='./dc.graph.min.js'></script>
    <script src='./dc.leaflet.min.js'></script>
    <title>Projeto</title>
  </head>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.13.0/d3-legend.js"></script>
    <script src="https://unpkg.com/@mapbox/leaflet-pip@latest/leaflet-pip.js"></script>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
     <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
       integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
       crossorigin=""></script>
       <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
   integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
   crossorigin=""/>
   <script src="https://unpkg.com/shpjs@latest/dist/shp.js"></script>
    <div>
      <!--<label for="contactChoice1">Ocorrências Aeronaúticas por Pontos</label>
      <input type="radio" name="visualizacaotipo" value="3" onclick="visualizacao1();"></br>
      <label for="contactChoice1">Ocorrências Aeronaúticas por Estados</label>
      <input type="radio" name="visualizacaotipo" value="2" onclick="visualizacao2();"></br>
      <label for="contactChoice1">Ocorrências Aeronaúticas por Municipios</label>
      <input type="radio" name="visualizacaotipo" value="1" onclick="visualizacao3();">-->
    </div>
    <div id="graph"></div>
    <div id="graph2"></div>
    <div id="graph3"></div>
    <div id="graph4"></div>
    <div id="mapid"></div>
    <style type="text/css">
      #mapid { height: 680px; width: 600px;}
      .info {
          padding: 6px 8px;
          font: 14px/16px Arial, Helvetica, sans-serif;
          background: white;
          background: rgba(255,255,255,0.8);
          box-shadow: 0 0 15px rgba(0,0,0,0.2);
          border-radius: 5px;
      }
      .info h4 {
          margin: 0 0 5px;
          color: #777;
      }
    </style>
  <script type="text/javascript">
    
    var mymap;
    

    shp("http://localhost:8080/mn_mappluto_17v1_1.zip").then(function(geojson){
      var cf = crossfilter(geojson[1].features);
      //console.log(geojson[1].features);
      //console.log(cf.size());
      console.log("1");
      var dimFireComp= cf.dimension(function(d){
        return d.properties.FireComp;
        //console.log(d);
      }); 
      var weaponDimFireComp= dimFireComp.group();
      //console.log(weaponDimFireComp.top(100));
       console.log("2");
      var dimRetailArea= cf.dimension(function(d){
        return d.properties.RetailArea;
        //console.log(d);
      }); 
      //console.log(dimRetailArea.top(5));
       console.log(dimRetailArea.top(5));
       console.log(dimRetailArea.bottom(5));
      var dimYearBuilt= cf.dimension(function(d){
        return d.properties.YearBuilt;
        //console.log(d);
      }); 
      var weaponDimYearBuilt= dimYearBuilt.group();
       console.log("4");
      var dimYearAlter1= cf.dimension(function(d){
        return d.properties.YearAlter1;
        //console.log(d);
      }); 
      var weaponDimYearAlter1= dimYearAlter1.group();
       console.log("5");
      var dimYearAlter2= cf.dimension(function(d){
        return d.properties.YearAlter2;
        //console.log(d);
      }); 
      var weaponDimYearAlter2= dimYearAlter2.group();
       console.log("6");
      var dimSHAPE_Area= cf.dimension(function(d){
        return d.properties.SHAPE_Area;
        //console.log(d);
      });
      console.log("7");
      var dimSHAPE_Leng= cf.dimension(function(d){
        return d.properties.SHAPE_Leng;
        //console.log(d);
      });
      console.log("8");
      var dimNumFloors= cf.dimension(function(d){
        return d.properties.NumFloors;
        //console.log(d);
      });
      var weaponNumFloors= dimNumFloors.group();
      console.log("9");
      var dimPolicePrct= cf.dimension(function(d){
        return d.properties.PolicePrct;
        //console.log(d);
      });
      var weaponPolicePrct= dimPolicePrct.group();
      console.log("10");
      var dimSchoolDist= cf.dimension(function(d){
        return d.properties.SchoolDist;
        //console.log(d);
      });
      var weaponSchoolDist= dimSchoolDist.group();
      console.log("11");
      var dimSanitDistr= cf.dimension(function(d){
        return d.properties.SanitDistr;
        //console.log(d);
      });
      var weaponSanitDistr= dimSanitDistr.group();
      var pieChart = dc.pieChart("#graph");
      pieChart
          .width(200)
          .height(200)
          .slicesCap(15)
          .innerRadius(5)
          .dimension(dimFireComp)
          .group(weaponDimFireComp)
          .renderLabel(true);
          console.log("ok");
      console.log("12");

      var dimHealthArea= cf.dimension(function(d){
        return d.properties.HealthArea;
      });
       console.log("13");

      var chart = dc.barChart("#graph2");
      chart.width(450)
            .height(200)
            .x(d3.scaleLinear().domain([1880,2000]))
            .brushOn(true)
            .yAxisLabel("Quantidade Construída")
            .xAxisLabel("Ano de Construção")
            .dimension(dimYearBuilt)
            .group(weaponDimYearBuilt);

      var chart = dc.barChart("#graph3");
      chart.width(450)
            .height(200)
            .x(d3.scaleLinear().domain([1930,2017]))
            .brushOn(true)
            .yAxisLabel("Quantidade Construída")
            .xAxisLabel("Ano de Construção")
            .dimension(dimYearAlter1)
            .group(weaponDimYearAlter1);

      var chart = dc.barChart("#graph4");
      chart.width(450)
            .height(200)
            .x(d3.scaleLinear().domain([1930,2017]))
            .brushOn(true)
            .yAxisLabel("Quantidade Construída")
            .xAxisLabel("Ano de Construção")
            .dimension(dimYearAlter2)
            .group(weaponDimYearAlter2);
      dc.renderAll();
    });
  
    /*if(mymap==undefined){
      mymap = L.map('mapid').setView([-15.7801,-47.9292], 4);
      //console.log(mymap);
    }else{
      mymap.eachLayer(function (layer) {
        mymap.remove();
        mymap.removeLayer(layer);
    });*/
    /*mymap = L.map('mapid').setView([40.7825452,-73.9829671], 12);
    
    
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox.streets',
    accessToken: 'pk.eyJ1IjoiZWRjbGV5OTQ1MiIsImEiOiJjamdvMGdmZ2owaTdiMndwYTJyM2tteTl2In0.2q25nBNRxzFxeaYahFGQ6g'
    }).addTo(mymap);

    shp("http://localhost:8080/mn_mappluto_17v1_1.zip").then(function(geojson){
      //do something with your geojson
      //console.log(geojson[1]);
      //console.log("a");
      geojson[1].features.slice(-5000).forEach(function(d, i){
        //console.log(i);
        L.geoJson(d).addTo(mymap);
      });
    });*/




    /*var json=d3.json("http://localhost:8080/MNMapPLUTO.json",function(error, data) {
      //console.log(error);
      
      data.features.forEach(function(d, i) { 
        if(d.properties.Borough=='MN'){
          L.geoJson(d.geometry).addTo(mymap);
           
        }
        //console.log(d.properties.Borough); 
      });
      });*/
      /*var csv=d3.csv("https://raw.githubusercontent.com/nosbielcs/opendata_aig_brazil/master/data/oco.csv",function (datacsv) {
          var expensesByName = d3.nest().key(function(d) { 
            return d['ocorrencia_cidade']; 
          }).entries(datacsv);
          expensesByName.sort(function(x, y){
             return d3.ascending(x.key, y.key);
          });
         L.geoJson(data,{style: function(feature){
          var aux=findObjectByKey(expensesByName,'key', feature['properties']['name'].toUpperCase());
            if(aux!= null){
              return{
                    fillColor: aux,
                    weight: 1,
                    opacity: 1,
                    color: 'white',
                    dashArray: '3',
                    fillOpacity: 0.5};
            }else{
              return{
                    fillColor: 'none',
                    weight: 1,
                    opacity: 1,
                    color: 'white',
                    dashArray: '3',
                    fillOpacity: 0.5};
            }
          }}).addTo(mymap);
      });*/
      /*
      var legend = L.control({position: 'bottomright'});
        legend.onAdd = function (mymap) {

          var div = L.DomUtil.create('div', 'info legend'),
              grades = [1,10,50,100,238],
              labels = [];
          for (var i = 0; i < grades.length; i++) {
              //console.log(color(grades[i]));
              div.innerHTML +=
                  '<i style="color:'+color(grades[i]) +'; background:' + color(grades[i]) + '">___</i> ' +
                  grades[i] +'<br>';
          }
          return div;
      };
      legend.addTo(mymap);*/
      /*var info = L.control();
      info.onAdd = function (mymap) {
          this._div = L.DomUtil.create('div', 'info');
          this.update();
          return this._div;
      };
      info.update = function (props) {
          this._div.innerHTML = '<h4>Número de Incidentes Aéreos </h4>' +  (props ?
              '<b>' + props.name + '</b><br />' + props.density + ' people / mi<sup>2</sup>'
              : 'Registrados Nas Cidades Brasileiras');
      };
      info.addTo(mymap);*/
    
  
  </script>
  </body>
</html>